/*
 * jQuery.dockmodal - jQuery dockable modal dialog widget
 *
 * Copyright 2014, uxMine
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * Date: 2/11/2014
 * @author Tarafder Ashek E Elahi
 * @version 1.1
 * Depends:
 *   jquery.js
 *
 */
;(function(e){function i(e,t){var n=e.options.animationSpeed/1e3;t.css({transition:n+"s right, "+n+"s left, "+n+"s top, "+n+"s bottom, "+n+"s height, "+n+"s width"});return true}function s(e){e.css({transition:"none"});return true}var t={width:400,height:"65%",minimizedWidth:200,gutter:10,poppedOutDistance:"6%",title:"",dialogClass:"",buttons:[],animationSpeed:400,opacity:1,initialState:"modal",showClose:true,showPopout:true,showMinimize:true,create:undefined,open:undefined,beforeClose:undefined,close:undefined,beforeMinimize:undefined,minimize:undefined,beforeRestore:undefined,restore:undefined,beforePopout:undefined,popout:undefined};var n="dockmodal";var r=e(window).width();var o={init:function(r){return this.each(function(){var s=e(this);var u=s.data("dockmodal");s.options=e.extend({},t,r);if(!u){s.data("dockmodal",s)}else{e("body").append(s.closest("."+n).show());o.refreshLayout();setTimeout(function(){o.restore.apply(s)},s.options.animationSpeed);return}var a=e("body");var f=e(window);var l=e("<div/>").addClass(n).addClass(s.options.dialogClass);if(s.options.initialState=="modal"){l.addClass("popped-out")}else if(s.options.initialState=="minimized"){l.addClass("minimized")}l.height(0);i(s,l);var c=e("<div></div>").addClass(n+"-header");if(s.options.showClose){e('<a href="#" class="header-action action-close" title="Close"><i class="icon-dockmodal-close"></i></a>').appendTo(c).click(function(e){o.destroy.apply(s);return false})}if(s.options.showPopout){e('<a href="#" class="header-action action-popout" title="Pop out"><i class="icon-dockmodal-popout"></i></a>').appendTo(c).click(function(e){if(l.hasClass("popped-out")){o.restore.apply(s)}else{o.popout.apply(s)}return false})}if(s.options.showMinimize){e('<a href="#" class="header-action action-minimize" title="Minimize"><i class="icon-dockmodal-minimize"></i></a>').appendTo(c).click(function(e){if(l.hasClass("minimized")){if(l.hasClass("popped-out")){o.popout.apply(s)}else{o.restore.apply(s)}}else{o.minimize.apply(s)}return false})}if(s.options.showMinimize&&s.options.showPopout){c.click(function(){if(l.hasClass("minimized")){if(l.hasClass("popped-out")){o.popout.apply(s)}else{o.restore.apply(s)}}else{o.minimize.apply(s)}return false})}c.append('<div class="title-text">'+(s.options.title||s.attr("title"))+"</div>");l.append(c);var h=e('<div class="modal-placeholder"></div>').insertAfter(s);s.placeholder=h;var p=e("<div></div>").addClass(n+"-body").append(s);l.append(p);if(s.options.buttons.length){var d=e("<div></div>").addClass(n+"-footer");var v=e("<div></div>").addClass(n+"-footer-buttonset");d.append(v);e.each(s.options.buttons,function(t,n){var r=e('<a href="#" class="btn"></a>');r.attr({id:n.id,"class":n.buttonClass});r.html(n.html);r.click(function(e){n.click(e,s);return false});v.append(r)});l.append(d)}else{l.addClass("no-footer")}var m=e("."+n+"-overlay");if(!m.length){m=e("<div/>").addClass(n+"-overlay")}if(e.isFunction(s.options.create)){s.options.create(s)}a.append(l);l.after(m);p.focus();if(e.isFunction(s.options.open)){setTimeout(function(){s.options.open(s)},s.options.animationSpeed)}if(l.hasClass("minimized")){l.find(".dockmodal-body, .dockmodal-footer").hide();o.minimize.apply(s)}else{if(l.hasClass("popped-out")){o.popout.apply(s)}else{o.restore.apply(s)}}a.data("windowWidth",f.width());f.unbind("resize.dockmodal").bind("resize.dockmodal",function(){if(f.width()==a.data("windowWidth")){return}a.data("windowWidth",f.width());o.refreshLayout()})})},destroy:function(){return this.each(function(){var t=e(this).data("dockmodal");if(!t)return;if(e.isFunction(t.options.beforeClose)){if(t.options.beforeClose(t)===false){return}}try{var r=t.closest("."+n);if(r.hasClass("popped-out")&&!r.hasClass("minimized")){r.css({left:"50%",right:"50%",top:"50%",bottom:"50%"})}else{r.css({width:"0",height:"0"})}setTimeout(function(){t.removeData("dockmodal");t.placeholder.replaceWith(t);r.remove();e("."+n+"-overlay").hide();o.refreshLayout();if(e.isFunction(t.options.close)){t.options.close(t)}},t.options.animationSpeed)}catch(i){alert(i.message)}})},close:function(){o.destroy.apply(this)},minimize:function(){return this.each(function(){var t=e(this).data("dockmodal");if(!t)return;if(e.isFunction(t.options.beforeMinimize)){if(t.options.beforeMinimize(t)===false){return}}var r=t.closest("."+n);var i=r.find(".dockmodal-header").outerHeight();r.addClass("minimized").css({width:t.options.minimizedWidth+"px",height:i+"px",left:"auto",right:"auto",top:"auto",bottom:"0"});setTimeout(function(){r.find(".dockmodal-body, .dockmodal-footer").hide();if(e.isFunction(t.options.minimize)){t.options.minimize(t)}},t.options.animationSpeed);e("."+n+"-overlay").hide();r.find(".action-minimize").attr("title","Restore");o.refreshLayout()})},restore:function(){return this.each(function(){var t=e(this).data("dockmodal");if(!t)return;if(e.isFunction(t.options.beforeRestore)){if(t.options.beforeRestore(t)===false){return}}var r=t.closest("."+n);r.removeClass("minimized popped-out");r.find(".dockmodal-body, .dockmodal-footer").show();r.css({width:t.options.width+"px",height:t.options.height,left:"auto",right:"auto",top:"auto",bottom:"0"});e("."+n+"-overlay").hide();r.find(".action-minimize").attr("title","Minimize");r.find(".action-popout").attr("title","Pop-out");setTimeout(function(){if(e.isFunction(t.options.restore)){t.options.restore(t)}},t.options.animationSpeed);o.refreshLayout()})},popout:function(){return this.each(function(){var t=e(this).data("dockmodal");if(!t)return;if(e.isFunction(t.options.beforePopout)){if(t.options.beforePopout(t)===false){return}}var r=t.closest("."+n);r.find(".dockmodal-body, .dockmodal-footer").show();s(r);var u=r.position();var a=e(window).width();r.css({width:"auto",height:"auto",left:u.left+"px",right:a-u.left-r.outerWidth(true)+"px",top:u.top+"px",bottom:0});i(t,r);setTimeout(function(){r.removeClass("minimized").addClass("popped-out").css({width:"auto",height:"auto",left:t.options.poppedOutDistance,right:t.options.poppedOutDistance,top:t.options.poppedOutDistance,bottom:t.options.poppedOutDistance});e("."+n+"-overlay").show();r.find(".action-popout").attr("title","Pop-in");o.refreshLayout()},10);setTimeout(function(){if(e.isFunction(t.options.popout)){t.options.popout(t)}},t.options.animationSpeed)})},refreshLayout:function(){var t=0;var r=e(window).width();e.each(e("."+n).toArray().reverse(),function(i,s){var o=e(this);var u=o.find("."+n+"-body > div").data("dockmodal");if(o.hasClass("popped-out")&&!o.hasClass("minimized")){return}t+=u.options.gutter;o.css({right:t+"px"});if(o.hasClass("minimized")){t+=u.options.minimizedWidth}else{t+=u.options.width}if(t>r){o.hide()}else{setTimeout(function(){o.show()},u.options.animationSpeed)}})}};e.fn.dockmodal=function(t){if(o[t]){return o[t].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof t==="object"||!t){return o.init.apply(this,arguments)}else{e.error("Method "+t+" does not exist on jQuery.dockmodal")}}})(jQuery);